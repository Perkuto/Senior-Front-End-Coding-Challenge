<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Flickr Picture Search</title>

    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<style>
		#search input{width:100%;padding:20px;font-size:20px;}
		img{max-width:100%;}
		#result{margin-top:50px;padding-bottom:200px;}
	</style>
	
  </head>
  <body>
    
	<div class="container">
	
		<h1>Flickr Picture Search</h1>
		
		<div id="search">
			<input type="text"/>
		</div>
		
		<div id="result">
			<div class="row">
		
			</div>
		</div>
		
	</div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
	
	<script>
	
		$(function(){
			
			$('#search input').focus();
			
			$('#search input').keyup(function(){			
				search_input_keyup(true);			
			});
			
			$(window).scroll(function() {
			   if($(window).scrollTop() + $(window).height() == $(document).height()) {
				   search_input_keyup(false)
			   }
			});
			
		});
		
		function search_input_keyup(clear){
			console.log( $('#search input').val() );
			var text = $('#search input').val();
			
			fetch_data(text,clear);
		}
		
		function clearResult(){
			$('#result').html('');
		}
		
		function fetch_data(text,clear){
			url = 'https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=5f588edf89c1acce3b1027e05d119318&tags=[[tags]]&format=json&nojsoncallback=1&per_page=6';
			url = url.replace('[[tags]]',text);
			console.log(url);
			
			data = {};
					
			$.getJSON( url, function( data ) {
				
				//console.log(data.photos.photo);
				
				render(data.photos.photo,clear);
			});
		
		}
		
		function render(photoList,clear){
			
			console.log(photoList);
			
			if(clear){
				clearResult();
			}
			
			
			
			for(i=0;i<photoList.length;i++) {
			
				photo = photoList[i];
				t_url = "http://farm" + photo.farm + ".static.flickr.com/" + photo.server + "/" + photo.id + "_" + photo.secret + "_" + "c.jpg";
				
				var pic = '<div class="col-xs-12 col-md-4 text-center"><img src="' + t_url + '"/></div>';
								
				$('#result .row').append(pic);
			}
			
			
			
		}
	
	</script>
  </body>
</html>